<!-- Patient Registration Modal - SECCIÓN MODIFICADA -->
<div class="modal-overlay" id="patient-modal">
  <div class="modal large-modal">
    <button class="modal-close" data-close="patient-modal">
      <i class="fas fa-times"></i>
    </button>
    <h2>Solicitud de Ayuda - Confidencial</h2>
    
    <div class="form-progress">
      <div class="progress-bar">
        <div class="progress-fill" id="form-progress"></div>
      </div>
      <span class="progress-text" id="progress-text">Paso 1 de 3</span>
    </div>

    <form id="patient-form" class="multi-step-form">
      <!-- Paso 1: Tipo de solicitud y datos básicos -->
      <div class="form-step active" data-step="1">
        <h3>Tipo de solicitud</h3>
        
        <div class="form-group">
          <label class="form-label">¿Cómo te gustaría proceder? *</label>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="tipoSolicitud" value="anonimo" required>
              <span class="radio-custom"></span>
              Mantenerme anónimo por ahora
            </label>
            <label class="radio-option">
              <input type="radio" name="tipoSolicitud" value="identificado" required>
              <span class="radio-custom"></span>
              Proporcionar mis datos para contacto directo
            </label>
            <label class="radio-option">
              <input type="radio" name="tipoSolicitud" value="informacion" required>
              <span class="radio-custom"></span>
              Solo necesito información sobre el programa
            </label>
          </div>
        </div>

        <!-- Campo de teléfono para anónimos (oculto por defecto) -->
        <div class="form-group" id="anonymous-phone-container" style="display: none;">
          <label class="form-label">Teléfono de contacto *</label>
          <input type="tel" class="form-input" id="anonymous-phone" placeholder="+56 9 1234 5678">
          <small style="color: var(--gray-600);">Tu número será utilizado únicamente para contactarte sobre tu solicitud</small>
        </div>

        <!-- Campo de email para solo información (oculto por defecto) -->
        <div class="form-group" id="info-email-container" style="display: none;">
          <label class="form-label">Email para recibir información *</label>
          <input type="email" class="form-input" id="info-email" placeholder="tu@email.com">
          <small style="color: var(--gray-600);">Te enviaremos información completa sobre el programa SENDA</small>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Tu edad *</label>
            <input type="number" class="form-input" id="patient-age" min="12" max="120" required>
          </div>
          <div class="form-group">
            <label class="form-label">Región *</label>
            <select class="form-select" id="patient-region" required>
              <option value="">Seleccionar región...</option>
              <!-- Se llenará dinámicamente con JavaScript -->
            </select>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">¿Para quién solicitas ayuda? *</label>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="paraMi" value="mi_mismo" required>
              <span class="radio-custom"></span>
              Para mí mismo/a
            </label>
            <label class="radio-option">
              <input type="radio" name="paraMi" value="familiar" required>
              <span class="radio-custom"></span>
              Para un familiar
            </label>
            <label class="radio-option">
              <input type="radio" name="paraMi" value="amigo" required>
              <span class="radio-custom"></span>
              Para un amigo/a
            </label>
          </div>
        </div>
      </div>

      <!-- Paso 2: Datos de contacto (SOLO para identificados) O Evaluación inicial (para anónimos/información) -->
      <div class="form-step" data-step="2">
        <h3>Datos de contacto</h3>
        <p class="step-description">Esta información nos permitirá contactarte directamente</p>
        
        <!-- Campos para solicitud identificada -->
        <div id="identified-contact-fields">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Nombre *</label>
              <input type="text" class="form-input" id="patient-name">
            </div>
            <div class="form-group">
              <label class="form-label">Apellidos *</label>
              <input type="text" class="form-input" id="patient-lastname">
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">RUT *</label>
            <input type="text" class="form-input" id="patient-rut" placeholder="12.345.678-9">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Teléfono *</label>
              <input type="tel" class="form-input" id="patient-phone" placeholder="+56 9 1234 5678">
            </div>
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" id="patient-email">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Comuna *</label>
              <select class="form-select" id="patient-comuna" disabled>
                <option value="">Primero selecciona una región</option>
                <!-- Se llenará dinámicamente según la región seleccionada -->
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Dirección</label>
              <input type="text" class="form-input" id="patient-address">
            </div>
          </div>
        </div>

        <!-- Campos para evaluación inicial (anónimos/información) -->
        <div id="evaluation-fields" style="display: none;">
          <div class="form-group">
            <label class="form-label">Tipo de sustancia principal *</label>
            <div class="checkbox-group">
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="alcohol">
                <span class="checkbox-custom"></span>
                Alcohol
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="marihuana">
                <span class="checkbox-custom"></span>
                Marihuana
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="cocaina">
                <span class="checkbox-custom"></span>
                Cocaína
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="pasta_base">
                <span class="checkbox-custom"></span>
                Pasta base
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="medicamentos">
                <span class="checkbox-custom"></span>
                Medicamentos
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="otras">
                <span class="checkbox-custom"></span>
                Otras
              </label>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Tiempo aproximado de consumo</label>
            <select class="form-select" id="tiempo-consumo">
              <option value="">Seleccionar...</option>
              <option value="6">Menos de 6 meses</option>
              <option value="12">6 meses - 1 año</option>
              <option value="24">1 - 2 años</option>
              <option value="60">2 - 5 años</option>
              <option value="120">Más de 5 años</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Motivación para el cambio (1-10)</label>
            <input type="range" class="form-range" id="motivacion" min="1" max="10" value="5">
            <div class="range-labels">
              <span>1 - Poco motivado</span>
              <span id="motivacion-value">5</span>
              <span>10 - Muy motivado</span>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Urgencia de la situación</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="urgencia" value="baja">
                <span class="radio-custom"></span>
                No es urgente
              </label>
              <label class="radio-option">
                <input type="radio" name="urgencia" value="moderada">
                <span class="radio-custom"></span>
                Moderada
              </label>
              <label class="radio-option">
                <input type="radio" name="urgencia" value="alta">
                <span class="radio-custom"></span>
                Urgente
              </label>
              <label class="radio-option">
                <input type="radio" name="urgencia" value="critica">
                <span class="radio-custom"></span>
                Emergencia
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Paso 3: Evaluación e información adicional (para identificados) O solo información adicional (para anónimos/información) -->
      <div class="form-step" data-step="3">
        <h3>Información adicional</h3>
        
        <!-- Evaluación para identificados (que no la llenaron en paso 2) -->
        <div id="identified-evaluation-fields" style="display: none;">
          <div class="form-group">
            <label class="form-label">Tipo de sustancia principal *</label>
            <div class="checkbox-group">
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="alcohol">
                <span class="checkbox-custom"></span>
                Alcohol
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="marihuana">
                <span class="checkbox-custom"></span>
                Marihuana
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="cocaina">
                <span class="checkbox-custom"></span>
                Cocaína
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="pasta_base">
                <span class="checkbox-custom"></span>
                Pasta base
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="medicamentos">
                <span class="checkbox-custom"></span>
                Medicamentos
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="otras">
                <span class="checkbox-custom"></span>
                Otras
              </label>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Tiempo aproximado de consumo</label>
            <select class="form-select" id="tiempo-consumo">
              <option value="">Seleccionar...</option>
              <option value="6">Menos de 6 meses</option>
              <option value="12">6 meses - 1 año</option>
              <option value="24">1 - 2 años</option>
              <option value="60">2 - 5 años</option>
              <option value="120">Más de 5 años</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Motivación para el cambio (1-10)</label>
            <input type="range" class="form-range" id="motivacion" min="1" max="10" value="5">
            <div class="range-labels">
              <span>1 - Poco motivado</span>
              <span id="motivacion-value">5</span>
              <span>10 - Muy motivado</span>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Urgencia de la situación</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="urgencia" value="baja">
                <span class="radio-custom"></span>
                No es urgente
              </label>
              <label class="radio-option">
                <input type="radio" name="urgencia" value="moderada">
                <span class="radio-custom"></span>
                Moderada
              </label>
              <label class="radio-option">
                <input type="radio" name="urgencia" value="alta">
                <span class="radio-custom"></span>
                Urgente
              </label>
              <label class="radio-option">
                <input type="radio" name="urgencia" value="critica">
                <span class="radio-custom"></span>
                Emergencia
              </label>
            </div>
          </div>
        </div>
        
        <!-- Información adicional para todos -->
        <div class="form-group">
          <label class="form-label">Cuéntanos tu situación (opcional)</label>
          <textarea class="form-textarea" id="patient-reason" placeholder="Describe brevemente tu situación actual y qué tipo de ayuda necesitas..."></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">¿Has recibido tratamiento anteriormente?</label>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="tratamientoPrevio" value="no">
              <span class="radio-custom"></span>
              No, es mi primera vez
            </label>
            <label class="radio-option">
              <input type="radio" name="tratamientoPrevio" value="si_senda">
              <span class="radio-custom"></span>
              Sí, en SENDA
            </label>
            <label class="radio-option">
              <input type="radio" name="tratamientoPrevio" value="si_otro">
              <span class="radio-custom"></span>
              Sí, en otro lugar
            </label>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Centro de preferencia</label>
          <select class="form-select" id="centro-preferencia">
            <option value="">Sin preferencia</option>
            <option value="cesfam_la_florida">CESFAM La Florida</option>
            <option value="cesfam_maipu">CESFAM Maipú</option>
            <option value="cesfam_providencia">CESFAM Providencia</option>
          </select>
        </div>
      </div>

      <div class="form-navigation">
        <button type="button" class="btn btn-outline" id="prev-step" style="display: none;">
          <i class="fas fa-arrow-left"></i>
          Anterior
        </button>
        <button type="button" class="btn btn-secondary" id="save-draft">
          <i class="fas fa-save"></i>
          Guardar borrador
        </button>
        <button type="button" class="btn btn-primary" id="next-step">
          Siguiente
          <i class="fas fa-arrow-right"></i>
        </button>
        <button type="submit" class="btn btn-success" id="submit-form" style="display: none;">
          <i class="fas fa-paper-plane"></i>
          Enviar Solicitud
        </button>
      </div>
    </form>
  </div>
</div>
