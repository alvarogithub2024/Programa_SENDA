<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SENDA - Sistema de Gesti√≥n Integral</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">
        <i class="fas fa-heartbeat"></i>
        <span>SENDA</span>
      </div>
      <div class="header-actions">
        <button class="btn btn-outline" id="find-center">
          <i class="fas fa-map-marker-alt"></i>
          Encontrar Centro
        </button>
        <button class="btn btn-professional" id="login-professional">
          <i class="fas fa-user-md"></i>
          Acceso Profesional
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="hero-card">
      <h1>Programa SENDA</h1>
      <p class="subtitle">Tu recuperaci√≥n comienza aqu√≠</p>
      
      <p class="description">
        Un espacio seguro y confidencial para solicitar ayuda cuando est√©s listo. 
        SENDA busca mitigar el impacto social y sanitario de los consumos de alcohol y otras drogas, 
        mejorando el bienestar y la calidad de vida en las personas y comunidades.
      </p>

      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-number">1,250+</span>
          <span class="stat-label">Pacientes Atendidos</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">48</span>
          <span class="stat-label">Profesionales Activos</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">95%</span>
          <span class="stat-label">Satisfacci√≥n</span>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn btn-primary" id="register-patient">
          <i class="fas fa-user-plus"></i>
          Solicitar Ayuda
        </button>
        <button class="btn btn-secondary" id="reentry-program">
          <i class="fas fa-redo"></i>
          Reingresar al Programa
        </button>
        <button class="btn btn-outline" id="about-program">
          <i class="fas fa-info-circle"></i>
          Sobre el Programa
        </button>
      </div>

      <div class="emergency-info">
        <p class="emergency-title">¬øNecesitas ayuda inmediata?</p>
        <div class="emergency-numbers">
          <span>üö® Emergencias: 131</span>
          <span>üìû SENDA: 1412 (gratuito)</span>
        </div>
      </div>

      <div class="features">
        <span>‚úì Confidencial</span>
        <span>‚úì Disponible 24/7</span>
        <span>‚úì Sin juicios</span>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <p>Para m√°s informaci√≥n oficial sobre SENDA:</p>
      <a href="https://www.senda.gob.cl" target="_blank" class="footer-link">
        <i class="fas fa-globe"></i>
        Sitio Oficial SENDA
      </a>
      <p style="margin-top: 16px; font-size: 14px; color: var(--gray-400);">
        Sistema interno para profesionales del Programa SENDA
      </p>
    </div>
  </footer>

  <!-- Patient Registration Modal - COMPLETAMENTE REESTRUCTURADO EN 4 PASOS -->
  <div class="modal-overlay" id="patient-modal">
    <div class="modal large-modal">
      <button class="modal-close" data-close="patient-modal">
        <i class="fas fa-times"></i>
      </button>
      <h2>Solicitud de Ayuda - Confidencial</h2>
      
      <div class="form-progress">
        <div class="progress-bar">
          <div class="progress-fill" id="form-progress"></div>
        </div>
        <span class="progress-text" id="progress-text">Paso 1 de 4</span>
      </div>

      <form id="patient-form" class="multi-step-form">
        <!-- PASO 1: Tipo de solicitud y datos b√°sicos -->
        <div class="form-step active" data-step="1">
          <h3>Tipo de solicitud</h3>
          
          <div class="form-group">
            <label class="form-label">¬øC√≥mo te gustar√≠a proceder? *</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="tipoSolicitud" value="anonimo" required>
                <span class="radio-custom"></span>
                Mantenerme an√≥nimo por ahora
              </label>
              <label class="radio-option">
                <input type="radio" name="tipoSolicitud" value="identificado" required>
                <span class="radio-custom"></span>
                Proporcionar mis datos para contacto directo
              </label>
              <label class="radio-option">
                <input type="radio" name="tipoSolicitud" value="informacion" required>
                <span class="radio-custom"></span>
                Solo necesito informaci√≥n sobre el programa
              </label>
            </div>
          </div>

          <!-- Campo de tel√©fono para an√≥nimos (oculto por defecto) -->
          <div class="form-group" id="anonymous-phone-container" style="display: none;">
            <label class="form-label">Tel√©fono de contacto *</label>
            <input type="tel" class="form-input" id="anonymous-phone" placeholder="+56 9 1234 5678">
            <small style="color: var(--gray-600);">Tu n√∫mero ser√° utilizado √∫nicamente para contactarte sobre tu solicitud</small>
          </div>

          <!-- Campo de email para solo informaci√≥n (oculto por defecto) -->
          <div class="form-group" id="info-email-container" style="display: none;">
            <label class="form-label">Email para recibir informaci√≥n *</label>
            <input type="email" class="form-input" id="info-email" placeholder="tu@email.com">
            <small style="color: var(--gray-600);">Te enviaremos informaci√≥n completa sobre el programa SENDA</small>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Tu edad *</label>
              <input type="number" class="form-input" id="patient-age" min="12" max="120" required>
            </div>
            <div class="form-group">
              <label class="form-label">Regi√≥n *</label>
              <select class="form-select" id="patient-region" required>
                <option value="">Seleccionar regi√≥n...</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">¬øPara qui√©n solicitas ayuda? *</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="paraMi" value="mi_mismo" required>
                <span class="radio-custom"></span>
                Para m√≠ mismo/a
              </label>
              <label class="radio-option">
                <input type="radio" name="paraMi" value="familiar" required>
                <span class="radio-custom"></span>
                Para un familiar
              </label>
              <label class="radio-option">
                <input type="radio" name="paraMi" value="amigo" required>
                <span class="radio-custom"></span>
                Para un amigo/a
              </label>
            </div>
          </div>
        </div>

        <!-- PASO 2: Datos de contacto (SOLO para identificados) -->
        <div class="form-step" data-step="2">
          <h3>Datos de contacto</h3>
          <p class="step-description">Esta informaci√≥n nos permitir√° contactarte directamente</p>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Nombre *</label>
              <input type="text" class="form-input" id="patient-name" required>
            </div>
            <div class="form-group">
              <label class="form-label">Apellidos *</label>
              <input type="text" class="form-input" id="patient-lastname" required>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">RUT *</label>
            <input type="text" class="form-input" id="patient-rut" placeholder="12.345.678-9" required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Tel√©fono *</label>
              <input type="tel" class="form-input" id="patient-phone" placeholder="+56 9 1234 5678" required>
            </div>
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" id="patient-email">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Comuna *</label>
              <select class="form-select" id="patient-comuna" disabled required>
                <option value="">Primero selecciona una regi√≥n</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Direcci√≥n</label>
              <input type="text" class="form-input" id="patient-address">
            </div>
          </div>
        </div>

        <!-- PASO 3: Evaluaci√≥n inicial -->
        <div class="form-step" data-step="3">
          <h3>Evaluaci√≥n inicial</h3>
          <p class="step-description">Esta informaci√≥n nos ayuda a brindarte la mejor atenci√≥n</p>

          <div class="form-group">
            <label class="form-label">Tipo de sustancia principal *</label>
            <div class="checkbox-group">
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="alcohol">
                <span class="checkbox-custom"></span>
                Alcohol
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="marihuana">
                <span class="checkbox-custom"></span>
                Marihuana
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="cocaina">
                <span class="checkbox-custom"></span>
                Coca√≠na
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="pasta_base">
                <span class="checkbox-custom"></span>
                Pasta base
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="medicamentos">
                <span class="checkbox-custom"></span>
                Medicamentos
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="sustancias" value="otras">
                <span class="checkbox-custom"></span>
                Otras
              </label>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Tiempo aproximado de consumo</label>
            <select class="form-select" id="tiempo-consumo">
              <option value="">Seleccionar...</option>
              <option value="6">Menos de 6 meses</option>
              <option value="12">6 meses - 1 a√±o</option>
              <option value="24">1 - 2 a√±os</option>
              <option value="60">2 - 5 a√±os</option>
              <option value="120">M√°s de 5 a√±os</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Motivaci√≥n para el cambio (1-10)</label>
            <input type="range" class="form-range" id="motivacion" min="1" max="10" value="5">
            <div class="range-labels">
              <span>1 - Poco motivado</span>
              <span id="motivacion-value">5</span>
              <span>10 - Muy motivado</span>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Urgencia de la situaci√≥n</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="urgencia" value="baja">
                <span class="radio-custom"></span>
                No es urgente
              </label>
              <label class="radio-option">
                <input type="radio" name="urgencia" value="moderada">
                <span class="radio-custom"></span>
                Moderada
              </label>
              <label class="radio-option">
                <input type="radio" name="urgencia" value="alta">
                <span class="radio-custom"></span>
                Urgente
              </label>
              <label class="radio-option">
                <input type="radio" name="urgencia" value="critica">
                <span class="radio-custom"></span>
                Emergencia
              </label>
            </div>
          </div>
        </div>

        <!-- PASO 4: Informaci√≥n adicional -->
        <div class="form-step" data-step="4">
          <h3>Informaci√≥n adicional</h3>
          <p class="step-description">Informaci√≥n complementaria para personalizar tu atenci√≥n</p>
        
          <div class="form-group">
            <label class="form-label">Cu√©ntanos tu situaci√≥n (opcional)</label>
            <textarea class="form-textarea" id="patient-reason" placeholder="Describe brevemente tu situaci√≥n actual y qu√© tipo de ayuda necesitas..."></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">¬øHas recibido tratamiento anteriormente?</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="tratamientoPrevio" value="no">
                <span class="radio-custom"></span>
                No, es mi primera vez
              </label>
              <label class="radio-option">
                <input type="radio" name="tratamientoPrevio" value="si_senda">
                <span class="radio-custom"></span>
                S√≠, en SENDA
              </label>
              <label class="radio-option">
                <input type="radio" name="tratamientoPrevio" value="si_otro">
                <span class="radio-custom"></span>
                S√≠, en otro lugar
              </label>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Centro de preferencia</label>
            <select class="form-select" id="centro-preferencia">
              <option value="">Sin preferencia</option>
              <option value="cesfam_la_florida">CESFAM La Florida</option>
              <option value="cesfam_maipu">CESFAM Maip√∫</option>
              <option value="cesfam_providencia">CESFAM Providencia</option>
            </select>
          </div>
        </div>

        <div class="form-navigation">
          <button type="button" class="btn btn-outline" id="prev-step" style="display: none;">
            <i class="fas fa-arrow-left"></i>
            Anterior
          </button>
          <button type="button" class="btn btn-secondary" id="save-draft">
            <i class="fas fa-save"></i>
            Guardar borrador
          </button>
          <button type="button" class="btn btn-primary" id="next-step">
            Siguiente
            <i class="fas fa-arrow-right"></i>
          </button>
          <button type="submit" class="btn btn-success" id="submit-form" style="display: none;">
            <i class="fas fa-paper-plane"></i>
            Enviar Solicitud
          </button>
        </div>
      </form>
    </div>
  </div>
  
<!-- Paso de Reingreso -->
<div class="form-step" data-step="reingreso" id="reingreso-step" style="display:none">
  <h3>Formulario de Reingreso</h3>
  <div class="form-group">
    <label class="form-label">Nombre completo *</label>
    <input type="text" class="form-input" id="reingreso-nombre" required>
  </div>
  <div class="form-group">
    <label class="form-label">RUT *</label>
    <input type="text" class="form-input" id="reingreso-rut" required>
  </div>
  <div class="form-group">
    <label class="form-label">Tel√©fono *</label>
    <input type="tel" class="form-input" id="reingreso-telefono" required>
  </div>
  <div class="form-group">
    <label class="form-label">Correo electr√≥nico *</label>
    <input type="email" class="form-input" id="reingreso-correo" required>
  </div>
  <div class="form-group">
    <label class="form-label">Motivo del reingreso *</label>
    <textarea class="form-input" id="reingreso-motivo" required></textarea>
  </div>
</div>
  
  <!-- Professional Panel Modal -->
  <div class="modal-overlay" id="panel-modal">
    <div class="modal professional-panel">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-header">
          <div class="user-info">
            <div class="user-avatar" id="user-avatar">DR</div>
            <div>
              <div id="user-name" style="font-weight: 600;">Dr. Juan P√©rez</div>
              <div id="user-role" style="font-size: 14px; opacity: 0.8;">M√©dico</div>
            </div>
          </div>
        </div>

        <nav class="nav-menu">
          <div class="nav-item active" data-panel="dashboard">
            <i class="fas fa-chart-line"></i>
            Dashboard
          </div>
          <div class="nav-item" data-panel="requests">
            <i class="fas fa-inbox"></i>
            Solicitudes
            <span class="badge" id="requests-badge">0</span>
          </div>
          <div class="nav-item" data-panel="patients">
            <i class="fas fa-users"></i>
            Pacientes
          </div>
          <div class="nav-item" data-panel="calendar">
            <i class="fas fa-calendar-alt"></i>
            Agenda
          </div>
          <div class="nav-item" data-panel="followups">
            <i class="fas fa-clipboard-list"></i>
            Seguimientos
          </div>
          <div class="nav-item" data-panel="reports">
            <i class="fas fa-file-medical-alt"></i>
            Reportes
          </div>
          <div class="nav-item" data-panel="centers" id="centers-nav" style="display: none;">
            <i class="fas fa-hospital"></i>
            Centros
          </div>
          <div class="nav-item" data-panel="users" id="users-nav" style="display: none;">
            <i class="fas fa-user-cog"></i>
            Usuarios
          </div>
          <div class="nav-item" data-panel="analytics" id="analytics-nav" style="display: none;">
            <i class="fas fa-chart-bar"></i>
            Analytics
          </div>
        </nav>

        <div class="sidebar-footer">
          <button class="logout-btn" id="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            Cerrar Sesi√≥n
          </button>
        </div>
      </div>

      <!-- Main Panel -->
      <div class="main-panel">
        <!-- Dashboard Panel -->
        <div class="panel-content active" id="dashboard-panel">
          <div class="panel-header">
            <h1 class="panel-title">Dashboard</h1>
            <p class="panel-subtitle">Resumen general de actividades</p>
          </div>

          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-header">
                <h3>Pacientes Activos</h3>
                <i class="fas fa-users metric-icon"></i>
              </div>
              <div class="metric-value" id="total-patients">0</div>
              <div class="metric-change positive">
                <i class="fas fa-arrow-up"></i> +12% desde el mes pasado
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-header">
                <h3>Citas Hoy</h3>
                <i class="fas fa-calendar metric-icon"></i>
              </div>
              <div class="metric-value" id="today-appointments">0</div>
              <div class="metric-detail">
                Pr√≥xima cita: <span id="next-appointment">--:--</span>
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-header">
                <h3>Solicitudes Pendientes</h3>
                <i class="fas fa-clock metric-icon"></i>
              </div>
              <div class="metric-value" id="pending-requests">0</div>
              <div class="metric-change negative">
                Requieren atenci√≥n inmediata
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-header">
                <h3>Casos Cr√≠ticos</h3>
                <i class="fas fa-exclamation-triangle metric-icon"></i>
              </div>
              <div class="metric-value critical" id="critical-cases">0</div>
              <div class="metric-detail">
                √öltima alerta: <span id="last-alert">N/A</span>
              </div>
            </div>
          </div>

          <div class="dashboard-charts">
            <div class="chart-container">
              <h3>Casos por Prioridad</h3>
              <canvas id="priority-chart"></canvas>
            </div>
            <div class="chart-container">
              <h3>Tendencia Mensual</h3>
              <canvas id="trend-chart"></canvas>
            </div>
          </div>

          <div class="recent-activity">
            <h3>Actividad Reciente</h3>
            <div id="activity-list">
              <!-- Se llenar√° din√°micamente -->
            </div>
          </div>
        </div>

        <!-- Requests Panel -->
        <div class="panel-content hidden" id="requests-panel">
          <div class="panel-header">
            <h1 class="panel-title">Gesti√≥n de Solicitudes</h1>
            <p class="panel-subtitle">Revisa y gestiona las solicitudes pendientes</p>
          </div>

          <div class="filters-section">
            <div class="filter-group">
              <select class="form-select" id="filter-priority">
                <option value="">Todas las prioridades</option>
                <option value="critica">Cr√≠tica</option>
                <option value="alta">Alta</option>
                <option value="media">Media</option>
                <option value="baja">Baja</option>
              </select>
              
              <select class="form-select" id="filter-status">
                <option value="">Todos los estados</option>
                <option value="pendiente">Pendiente</option>
                <option value="en_proceso">En proceso</option>
                <option value="atendido">Atendido</option>
              </select>

              <input type="date" class="form-input" id="filter-date">
              
              <button class="btn btn-outline" id="clear-filters">
                <i class="fas fa-times"></i>
                Limpiar
              </button>
            </div>
          </div>

          <div id="requests-list">
            <!-- Las solicitudes se cargar√°n aqu√≠ din√°micamente -->
          </div>
        </div>
<!-- Agregar estos paneles despu√©s del requests-panel existente en el HTML -->

<!-- Patients Panel -->
<div class="panel-content hidden" id="patients-panel">
  <!-- El contenido se cargar√° din√°micamente desde JavaScript -->
</div>

<!-- Calendar Panel -->
<div class="panel-content hidden" id="calendar-panel">
  <!-- El contenido se cargar√° din√°micamente desde JavaScript -->
</div>

<!-- Followups Panel -->
<div class="panel-content hidden" id="followups-panel">
  <!-- El contenido se cargar√° din√°micamente desde JavaScript -->
</div>

<!-- Reports Panel -->
<div class="panel-content hidden" id="reports-panel">
  <!-- El contenido se cargar√° din√°micamente desde JavaScript -->
</div>

<!-- Centers Panel (para coordinadores y admins) -->
<div class="panel-content hidden" id="centers-panel">
  <div class="panel-header">
    <h1 class="panel-title">Gesti√≥n de Centros</h1>
    <p class="panel-subtitle">Administra los centros de salud y sus configuraciones</p>
  </div>
  
  <div class="search-section">
    <div class="search-container">
      <i class="fas fa-search search-icon"></i>
      <input type="text" id="centers-search" class="search-input" placeholder="Buscar centro por nombre o regi√≥n...">
    </div>
  </div>
  
  <div class="filters-section">
    <div class="filter-group">
      <select class="form-select" id="filter-center-type">
        <option value="">Todos los tipos</option>
        <option value="cesfam">CESFAM</option>
        <option value="hospital">Hospital</option>
        <option value="clinica">Cl√≠nica</option>
        <option value="centro_senda">Centro SENDA</option>
      </select>
      
      <select class="form-select" id="filter-center-region">
        <option value="">Todas las regiones</option>
        <!-- Las regiones se cargar√°n din√°micamente -->
      </select>
      
      <button class="btn btn-primary" id="add-center">
        <i class="fas fa-plus"></i> Agregar Centro
      </button>
    </div>
  </div>
  
  <div id="centers-list">
    <!-- Los centros se cargar√°n din√°micamente -->
    <div class="loading"><div class="spinner"></div> Cargando centros...</div>
  </div>
</div>

<!-- Users Panel (solo para admins) -->
<div class="panel-content hidden" id="users-panel">
  <div class="panel-header">
    <h1 class="panel-title">Gesti√≥n de Usuarios</h1>
    <p class="panel-subtitle">Administra profesionales y permisos del sistema</p>
  </div>
  
  <div class="search-section">
    <div class="search-container">
      <i class="fas fa-search search-icon"></i>
      <input type="text" id="users-search" class="search-input" placeholder="Buscar profesional por nombre o correo...">
    </div>
  </div>
  
  <div class="filters-section">
    <div class="filter-group">
      <select class="form-select" id="filter-user-profession">
        <option value="">Todas las profesiones</option>
        <option value="asistente_social">Asistente Social</option>
        <option value="medico">M√©dico</option>
        <option value="psicologo">Psic√≥logo</option>
        <option value="terapeuta">Terapeuta Ocupacional</option>
        <option value="coordinador">Coordinador Regional</option>
        <option value="admin">Administrador</option>
      </select>
      
      <select class="form-select" id="filter-user-status">
        <option value="">Todos los estados</option>
        <option value="activo">Activo</option>
        <option value="inactivo">Inactivo</option>
        <option value="pendiente">Pendiente</option>
      </select>
      
      <button class="btn btn-primary" id="invite-user">
        <i class="fas fa-user-plus"></i> Invitar Usuario
      </button>
    </div>
  </div>
  
  <div id="users-list">
    <!-- Los usuarios se cargar√°n din√°micamente -->
    <div class="loading"><div class="spinner"></div> Cargando usuarios...</div>
  </div>
</div>

<!-- Analytics Panel (para coordinadores y admins) -->
<div class="panel-content hidden" id="analytics-panel">
  <div class="panel-header">
    <h1 class="panel-title">Analytics y Estad√≠sticas</h1>
    <p class="panel-subtitle">An√°lisis detallado de datos y m√©tricas del sistema</p>
  </div>
  
  <div class="analytics-controls">
    <div class="filter-group">
      <input type="date" class="form-input" id="analytics-date-from" placeholder="Desde">
      <input type="date" class="form-input" id="analytics-date-to" placeholder="Hasta">
      
      <select class="form-select" id="analytics-period">
        <option value="month">√öltimo mes</option>
        <option value="quarter">√öltimo trimestre</option>
        <option value="year">√öltimo a√±o</option>
        <option value="custom">Per√≠odo personalizado</option>
      </select>
      
      <button class="btn btn-primary" id="generate-analytics">
        <i class="fas fa-chart-bar"></i> Generar An√°lisis
      </button>
      
      <button class="btn btn-secondary" id="export-analytics">
        <i class="fas fa-download"></i> Exportar Datos
      </button>
    </div>
  </div>
  
  <div class="analytics-summary">
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-header">
          <h3>Total Solicitudes</h3>
          <i class="fas fa-inbox metric-icon"></i>
        </div>
        <div class="metric-value" id="analytics-total-requests">0</div>
        <div class="metric-change" id="analytics-requests-change">
          Cargando...
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-header">
          <h3>Pacientes Activos</h3>
          <i class="fas fa-users metric-icon"></i>
        </div>
        <div class="metric-value" id="analytics-active-patients">0</div>
        <div class="metric-change" id="analytics-patients-change">
          Cargando...
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-header">
          <h3>Citas Realizadas</h3>
          <i class="fas fa-calendar-check metric-icon"></i>
        </div>
        <div class="metric-value" id="analytics-completed-appointments">0</div>
        <div class="metric-change" id="analytics-appointments-change">
          Cargando...
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-header">
          <h3>Tasa de √âxito</h3>
          <i class="fas fa-trophy metric-icon"></i>
        </div>
        <div class="metric-value" id="analytics-success-rate">0%</div>
        <div class="metric-change" id="analytics-success-change">
          Cargando...
        </div>
      </div>
    </div>
  </div>
  
  <div class="analytics-charts">
    <div class="chart-container">
      <h3>Solicitudes por Mes</h3>
      <canvas id="requests-by-month-chart"></canvas>
    </div>
    
    <div class="chart-container">
      <h3>Distribuci√≥n por Sustancia</h3>
      <canvas id="substances-distribution-chart"></canvas>
    </div>
    
    <div class="chart-container">
      <h3>Atenciones por Profesional</h3>
      <canvas id="appointments-by-professional-chart"></canvas>
    </div>
    
    <div class="chart-container">
      <h3>Tendencia de Recuperaci√≥n</h3>
      <canvas id="recovery-trend-chart"></canvas>
    </div>
  </div>
  
  <div class="analytics-tables">
    <div class="table-container">
      <h3>Top 10 Centros por Atenciones</h3>
      <div id="top-centers-table">
        <!-- Tabla se cargar√° din√°micamente -->
      </div>
    </div>
    
    <div class="table-container">
      <h3>An√°lisis por Regi√≥n</h3>
      <div id="regional-analysis-table">
        <!-- Tabla se cargar√° din√°micamente -->
      </div>
    </div>
  </div>
</div>
        <!-- Otros paneles se mantienen igual... -->
        <div class="panel-content hidden" id="patients-panel">
          <div class="panel-header">
            <h1 class="panel-title">Gesti√≥n de Pacientes</h1>
            <p class="panel-subtitle">Busca y gestiona informaci√≥n de pacientes</p>
          </div>
        </div>

        <div class="panel-content hidden" id="calendar-panel">
          <div class="panel-header">
            <h1 class="panel-title">Agenda</h1>
            <p class="panel-subtitle">Gestiona tus citas y horarios</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Center Finder Modal -->
  <div class="modal-overlay" id="center-modal">
    <div class="modal">
      <button class="modal-close" data-close="center-modal">
        <i class="fas fa-times"></i>
      </button>
      <h2>Encontrar Centro de Salud</h2>
      
      <div class="location-input">
        <div class="form-group">
          <label class="form-label">Tu ubicaci√≥n</label>
          <input type="text" class="form-input" id="location-input" placeholder="Ingresa tu direcci√≥n o permite geolocalizaci√≥n">
          <button class="btn btn-outline" id="use-location">
            <i class="fas fa-location-arrow"></i>
            Usar mi ubicaci√≥n
          </button>
        </div>
      </div>

      <div id="centers-list">
        <!-- Lista de centros se cargar√° din√°micamente -->
      </div>
    </div>
  </div>

  <!-- Professional Login Modal -->
  <div class="modal-overlay" id="professional-modal">
    <div class="modal">
      <button class="modal-close" data-close="professional-modal">
        <i class="fas fa-times"></i>
      </button>
      <h2>Acceso Profesional</h2>
      
      <div class="tabs">
        <div class="tab-list">
          <button class="tab-button active" data-tab="login">Iniciar Sesi√≥n</button>
          <button class="tab-button" data-tab="register">Registrarse</button>
        </div>
      </div>

      <!-- Login Tab -->
      <div class="tab-content active" id="login-tab">
        <form id="login-form">
          <div class="form-group">
            <label class="form-label">Correo Electr√≥nico</label>
            <input type="email" class="form-input" id="login-email" required>
          </div>
          <div class="form-group">
            <label class="form-label">Contrase√±a</label>
            <input type="password" class="form-input" id="login-password" required>
          </div>
          <div class="form-group">
            <label class="checkbox-option">
              <input type="checkbox" id="remember-me">
              <span class="checkbox-custom"></span>
              Recordar sesi√≥n
            </label>
          </div>
          <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 16px;">
            <i class="fas fa-sign-in-alt"></i>
            Iniciar Sesi√≥n
          </button>
        </form>
      </div>

      <!-- Register Tab -->
      <div class="tab-content" id="register-tab">
        <form id="register-form">
          <div class="form-group">
            <label class="form-label">Nombre Completo</label>
            <input type="text" class="form-input" id="register-name" required>
          </div>
          <div class="form-group">
            <label class="form-label">Correo Electr√≥nico</label>
            <input type="email" class="form-input" id="register-email" required>
          </div>
          <div class="form-group">
            <label class="form-label">Contrase√±a</label>
            <input type="password" class="form-input" id="register-password" required>
          </div>
          <div class="form-group">
            <label class="form-label">Profesi√≥n</label>
            <select class="form-select" id="register-profession" required>
              <option value="">Seleccionar profesi√≥n...</option>
              <option value="asistente_social">Asistente Social</option>
              <option value="medico">M√©dico</option>
              <option value="psicologo">Psic√≥logo</option>
              <option value="terapeuta">Terapeuta Ocupacional</option>
              <option value="coordinador">Coordinador Regional</option>
              <option value="admin">Administrador</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Centro de Salud</label>
            <select class="form-select" id="register-center" required>
              <option value="">Seleccionar centro...</option>
              <option value="cesfam_la_florida">CESFAM La Florida</option>
              <option value="cesfam_maipu">CESFAM Maip√∫</option>
              <option value="cesfam_providencia">CESFAM Providencia</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success" style="width: 100%; margin-top: 16px;">
            <i class="fas fa-user-plus"></i>
            Registrarse
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Notification Container -->
  <div id="notifications"></div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay hidden">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Cargando...</p>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
