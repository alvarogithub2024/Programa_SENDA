<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SENDA Puente Alto - Sistema de Gestión</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Cargando...</p>
        </div>
    </div>

    <!-- Notifications Container -->
    <div id="notifications" class="notifications-container"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-leaf"></i>
                <span>SENDA Puente Alto</span>
            </div>
            
            <!-- Professional Info (Hidden initially) -->
            <div id="professional-header" class="professional-header" style="display: none;">
                <div class="professional-info">
                    <div class="professional-avatar"></div>
                    <div class="professional-details">
                        <h4 id="professional-name"></h4>
                        <p id="professional-profession"></p>
                        <small id="professional-cesfam"></small>
                    </div>
                </div>
                <button id="logout-btn" class="btn btn-outline" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i>
                    Cerrar Sesión
                </button>
            </div>

            <!-- Login Button -->
            <button id="login-professional" class="btn btn-primary">
                <i class="fas fa-sign-in-alt"></i>
                Acceso Profesional
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Public Content -->
        <section id="public-content" class="public-content">
            <div class="hero">
                <div class="hero-content">
                    <h1>Programa SENDA Puente Alto</h1>
                    <p>Tratamiento y rehabilitación para problemas de consumo de drogas y alcohol</p>
                </div>
            </div>

            <div class="services">
                <div class="services-grid">
                    <div class="service-card">
                        <i class="fas fa-user-plus"></i>
                        <h3>Solicitar Ayuda</h3>
                        <p>Inicia tu proceso de recuperación solicitando una evaluación</p>
                        <button id="register-patient" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Solicitar Ayuda
                        </button>
                    </div>
                    
                    <div class="service-card">
                        <i class="fas fa-redo"></i>
                        <h3>Reingreso</h3>
                        <p>Solicita volver al programa si ya has estado en tratamiento</p>
                        <button id="reentry-program" class="btn btn-secondary">
                            <i class="fas fa-redo"></i>
                            Solicitar Reingreso
                        </button>
                    </div>
                    
                    <div class="service-card">
                        <i class="fas fa-info-circle"></i>
                        <h3>Información</h3>
                        <p>Conoce más sobre nuestros programas y servicios</p>
                        <button id="about-program" class="btn btn-outline">
                            <i class="fas fa-info"></i>
                            Más Información
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Professional Content -->
        <section id="professional-content" class="professional-content" style="display: none;">
            <!-- Navigation Tabs -->
            <nav class="nav-tabs">
                <button class="tab-btn active" data-tab="agenda">
                    <i class="fas fa-calendar"></i>
                    <span>Agenda</span>
                </button>
                <button class="tab-btn" data-tab="solicitudes">
                    <i class="fas fa-inbox"></i>
                    <span>Solicitudes</span>
                </button>
                <button class="tab-btn" data-tab="pacientes">
                    <i class="fas fa-users"></i>
                    <span>Pacientes</span>
                </button>
                <button class="tab-btn" data-tab="seguimiento">
                    <i class="fas fa-chart-line"></i>
                    <span>Seguimiento</span>
                </button>
            </nav>

            <!-- Tab Panes -->
            <div class="tab-content">
                <!-- Agenda Tab -->
                <div id="agenda-tab" class="tab-pane active">
                    <div class="agenda-layout">
                        <div class="calendar-section">
                            <div class="calendar-header">
                                <button id="prev-month" class="btn btn-outline btn-sm">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <h3 id="calendar-month-year"></h3>
                                <button id="next-month" class="btn btn-outline btn-sm">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                            <div id="calendar-grid" class="calendar-grid"></div>
                        </div>
                        
                        <div class="appointments-section">
                            <div class="appointments-header">
                                <h3>Citas del Día</h3>
                                <button id="nueva-cita-btn" class="btn btn-success btn-sm">
                                    <i class="fas fa-plus"></i>
                                    Nueva Cita
                                </button>
                            </div>
                            <div id="appointments-list" class="appointments-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Solicitudes Tab -->
                <div id="solicitudes-tab" class="tab-pane">
                    <div class="solicitudes-header">
                        <h2>Gestión de Solicitudes</h2>
                        <div class="solicitudes-filters">
                            <select id="priority-filter" class="form-select">
                                <option value="">Todas las prioridades</option>
                                <option value="critica">Crítica</option>
                                <option value="alta">Alta</option>
                                <option value="media">Media</option>
                                <option value="baja">Baja</option>
                            </select>
                        </div>
                    </div>
                    <div id="requests-container" class="requests-container"></div>
                </div>

                <!-- Pacientes Tab -->
                <div id="pacientes-tab" class="tab-pane">
                    <div class="pacientes-header">
                        <h2>Gestión de Pacientes</h2>
                        <div class="pacientes-search">
                            <div class="search-group">
                                <input type="text" id="search-pacientes-rut" class="form-input" placeholder="Buscar por RUT...">
                                <button id="buscar-paciente-btn" class="btn btn-primary">
                                    <i class="fas fa-search"></i>
                                    Buscar
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="pacientes-search-results"></div>
                    <div id="patients-grid" class="patients-grid"></div>
                </div>

                <!-- Seguimiento Tab -->
                <div id="seguimiento-tab" class="tab-pane">
                    <div class="seguimiento-layout">
                        <div class="timeline-section">
                            <h3>Pacientes de Hoy</h3>
                            <div id="patients-timeline" class="patients-timeline"></div>
                        </div>
                        
                        <div class="upcoming-section">
                            <h3>Próximas Citas</h3>
                            <div id="upcoming-appointments-grid" class="upcoming-appointments-grid"></div>
                            <div id="no-upcoming-section" class="no-results" style="display: none;">
                                <i class="fas fa-calendar-check"></i>
                                <p>No hay citas próximas programadas</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    
    <!-- Login/Register Modal -->
    <div id="login-modal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close" onclick="window.SENDA.cerrarModal('login-modal')">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="modal-header">
                <div class="modal-tabs">
                    <button class="modal-tab active" onclick="window.switchLoginTab('login')">Iniciar Sesión</button>
                    <button class="modal-tab" onclick="window.switchLoginTab('register')">Registrarse</button>
                </div>
            </div>

            <!-- Login Form -->
            <form id="login-form" class="auth-form active">
                <h2>Acceso Profesional</h2>
                
                <div class="form-group">
                    <label class="form-label">Email *</label>
                    <input type="email" id="login-email" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Contraseña *</label>
                    <input type="password" id="login-password" class="form-input" required>
                </div>
                
                <button type="submit" class="btn btn-primary btn-full">
                    <i class="fas fa-sign-in-alt"></i>
                    Iniciar Sesión
                </button>
            </form>

            <!-- Register Form -->
            <form id="register-form" class="auth-form">
                <h2>Registro de Profesional</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Nombre *</label>
                        <input type="text" id="register-nombre" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Apellidos *</label>
                        <input type="text" id="register-apellidos" class="form-input" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email @senda.cl *</label>
                    <input type="email" id="register-email" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Contraseña *</label>
                    <input type="password" id="register-password" class="form-input" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Profesión *</label>
                        <select id="register-profession" class="form-select" required>
                            <option value="">Seleccionar...</option>
                            <option value="asistente_social">Asistente Social</option>
                            <option value="medico">Médico</option>
                            <option value="psicologo">Psicólogo</option>
                            <option value="terapeuta">Terapeuta Ocupacional</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">CESFAM *</label>
                        <select id="register-cesfam" class="form-select" required>
                            <option value="">Seleccionar...</option>
                            <option value="CESFAM Alejandro del Río">CESFAM Alejandro del Río</option>
                            <option value="CESFAM Karol Wojtyla">CESFAM Karol Wojtyla</option>
                            <option value="CESFAM Laurita Vicuña">CESFAM Laurita Vicuña</option>
                            <option value="CESFAM Padre Manuel Villaseca">CESFAM Padre Manuel Villaseca</option>
                            <option value="CESFAM San Gerónimo">CESFAM San Gerónimo</option>
                            <option value="CESFAM Vista Hermosa">CESFAM Vista Hermosa</option>
                            <option value="CESFAM Bernardo Leighton">CESFAM Bernardo Leighton</option>
                            <option value="CESFAM Cardenal Raúl Silva Henriquez">CESFAM Cardenal Raúl Silva Henriquez</option>
                        </select>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-success btn-full">
                    <i class="fas fa-user-plus"></i>
                    Registrarse
                </button>
            </form>
        </div>
    </div>

    <!-- Patient Registration Modal -->
    <div id="patient-modal" class="modal-overlay">
        <div class="modal large-modal">
            <button class="modal-close" onclick="window.SENDA.cerrarModal('patient-modal')">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="modal-body">
                <div class="form-progress-container">
                    <div class="form-progress-bar">
                        <div id="form-progress" class="form-progress-fill"></div>
                    </div>
                    <span id="progress-text" class="form-progress-text">Paso 1 de 4</span>
                </div>

                <form id="patient-form">
                    <!-- Step 1: Request Type -->
                    <div class="form-step active" data-step="1">
                        <h2>Tipo de Solicitud</h2>
                        
                        <div class="form-group">
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="tipoSolicitud" value="identificado">
                                    <div class="radio-content">
                                        <h4>Solicitud Identificada</h4>
                                        <p>Proporciona tus datos personales para una evaluación completa</p>
                                    </div>
                                </label>
                                
                                <label class="radio-option">
                                    <input type="radio" name="tipoSolicitud" value="informacion">
                                    <div class="radio-content">
                                        <h4>Solo Información</h4>
                                        <p>Recibe información sobre nuestros programas por email</p>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Information Only -->
                        <div id="info-email-container" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Email para recibir información *</label>
                                <input type="email" id="info-email" class="form-input" placeholder="tu@email.com">
                            </div>
                        </div>

                        <!-- Basic Info -->
                        <div id="basic-info-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Edad *</label>
                                    <input type="number" id="patient-age" class="form-input" min="12" max="120" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">CESFAM *</label>
                                    <select id="patient-cesfam" class="form-select" required>
                                        <option value="">Seleccionar CESFAM...</option>
                                        <option value="CESFAM Alejandro del Río">CESFAM Alejandro del Río</option>
                                        <option value="CESFAM Karol Wojtyla">CESFAM Karol Wojtyla</option>
                                        <option value="CESFAM Laurita Vicuña">CESFAM Laurita Vicuña</option>
                                        <option value="CESFAM Padre Manuel Villaseca">CESFAM Padre Manuel Villaseca</option>
                                        <option value="CESFAM San Gerónimo">CESFAM San Gerónimo</option>
                                        <option value="CESFAM Vista Hermosa">CESFAM Vista Hermosa</option>
                                        <option value="CESFAM Bernardo Leighton">CESFAM Bernardo Leighton</option>
                                        <option value="CESFAM Cardenal Raúl Silva Henriquez">CESFAM Cardenal Raúl Silva Henriquez</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">¿La solicitud es para ti? *</label>
                                <div class="radio-group-inline">
                                    <label class="radio-inline">
                                        <input type="radio" name="paraMi" value="si" required>
                                        <span>Sí, es para mí</span>
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="paraMi" value="no" required>
                                        <span>No, es para otra persona</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" id="next-step-1" class="btn btn-primary">
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                            <button type="button" id="submit-step-1" class="btn btn-success" style="display: none;">
                                <i class="fas fa-paper-plane"></i>
                                Enviar Solicitud
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Personal Info -->
                    <div class="form-step" data-step="2">
                        <h2>Datos Personales</h2>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Nombre *</label>
                                <input type="text" id="patient-name" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Apellidos *</label>
                                <input type="text" id="patient-lastname" class="form-input" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">RUT *</label>
                                <input type="text" id="patient-rut" class="form-input" placeholder="12.345.678-9" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Teléfono *</label>
                                <input type="tel" id="patient-phone" class="form-input" placeholder="9 1234 5678" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" id="patient-email" class="form-input" placeholder="opcional">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Dirección</label>
                                <input type="text" id="patient-address" class="form-input" placeholder="opcional">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" id="prev-step-2" class="btn btn-outline">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="button" id="next-step-2" class="btn btn-primary">
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Consumption Info -->
                    <div class="form-step" data-step="3">
                        <h2>Información de Consumo</h2>
                        
                        <div class="form-group">
                            <label class="form-label">Sustancias problemáticas *</label>
                            <div class="checkbox-group">
                                <label class="checkbox-option">
                                    <input type="checkbox" name="sustancias" value="alcohol">
                                    <span>Alcohol</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="sustancias" value="marihuana">
                                    <span>Marihuana</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="sustancias" value="cocaina">
                                    <span>Cocaína</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="sustancias" value="pasta_base">
                                    <span>Pasta Base</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="sustancias" value="benzodiacepinas">
                                    <span>Benzodiacepinas</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="sustancias" value="otras">
                                    <span>Otras</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Tiempo de consumo</label>
                                <select id="tiempo-consumo" class="form-select">
                                    <option value="">Seleccionar...</option>
                                    <option value="menos_6_meses">Menos de 6 meses</option>
                                    <option value="6_12_meses">6 meses a 1 año</option>
                                    <option value="1_3_anos">1 a 3 años</option>
                                    <option value="3_5_anos">3 a 5 años</option>
                                    <option value="mas_5_anos">Más de 5 años</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Urgencia percibida *</label>
                                <div class="radio-group-inline">
                                    <label class="radio-inline">
                                        <input type="radio" name="urgencia" value="baja" required>
                                        <span>Baja</span>
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="urgencia" value="media" required>
                                        <span>Media</span>
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="urgencia" value="alta" required>
                                        <span>Alta</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">¿Has recibido tratamiento previo? *</label>
                            <div class="radio-group-inline">
                                <label class="radio-inline">
                                    <input type="radio" name="tratamientoPrevio" value="si" required>
                                    <span>Sí</span>
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="tratamientoPrevio" value="no" required>
                                    <span>No</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" id="prev-step-3" class="btn btn-outline">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="button" id="next-step-3" class="btn btn-primary">
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Additional Info -->
                    <div class="form-step" data-step="4">
                        <h2>Información Adicional</h2>
                        
                        <div class="form-group">
                            <label class="form-label">Motivación para el tratamiento (1-10)</label>
                            <div class="range-group">
                                <input type="range" id="motivacion-range" min="1" max="10" value="5" class="form-range">
                                <span id="motivacion-value" class="range-value">5</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Describe tu situación</label>
                            <textarea id="patient-description" class="form-textarea" rows="4" 
                                      placeholder="Describe brevemente tu situación actual y qué te motivó a buscar ayuda..."></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="button" id="prev-step-4" class="btn btn-outline">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="submit" id="submit-form" class="btn btn-success">
                                <i class="fas fa-paper-plane"></i>
                                Enviar Solicitud
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Reentry Modal -->
    <div id="reentry-modal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close" onclick="window.SENDA.cerrarModal('reentry-modal')">
                <i class="fas fa-times"></i>
            </button>
            
            <form id="reentry-form">
                <h2>Solicitud de Reingreso</h2>
                <p>Si ya has estado en tratamiento anteriormente y deseas reingresar al programa, completa este formulario.</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Nombre completo *</label>
                        <input type="text" id="reentry-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">RUT *</label>
                        <input type="text" id="reentry-rut" class="form-input" placeholder="12.345.678-9" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">CESFAM *</label>
                        <select id="reentry-cesfam" class="form-select" required>
                            <option value="">Seleccionar CESFAM...</option>
                            <option value="CESFAM Alejandro del Río">CESFAM Alejandro del Río</option>
                            <option value="CESFAM Karol Wojtyla">CESFAM Karol Wojtyla</option>
                            <option value="CESFAM Laurita Vicuña">CESFAM Laurita Vicuña</option>
                            <option value="CESFAM Padre Manuel Villaseca">CESFAM Padre Manuel Villaseca</option>
                            <option value="CESFAM San Gerónimo">CESFAM San Gerónimo</option>
                            <option value="CESFAM Vista Hermosa">CESFAM Vista Hermosa</option>
                            <option value="CESFAM Bernardo Leighton">CESFAM Bernardo Leighton</option>
                            <option value="CESFAM Cardenal Raúl Silva Henriquez">CESFAM Cardenal Raúl Silva Henriquez</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Teléfono *</label>
                        <input type="tel" id="reentry-phone" class="form-input" placeholder="9 1234 5678" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Motivo del reingreso *</label>
                    <textarea id="reentry-reason" class="form-textarea" rows="3" 
                              placeholder="Explica brevemente por qué deseas reingresar al programa..." required></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="window.SENDA.cerrarModal('reentry-modal')">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-paper-plane"></i>
                        Enviar Solicitud
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript Modules -->
<script type="module" src="main.js"></script>
    
    <!-- Global Functions for backwards compatibility -->
    <script>
        // Funciones globales para compatibilidad con HTML
        window.switchLoginTab = function(tab) {
            import('./src/js/autenticacion/login.js').then(m => m.alternarTabLogin(tab));
        };

        // Extender objeto global SENDA
        window.SENDA = {
            ...window.SENDA,
            
            crearCitaParaFecha: function(fechaIso) {
                import('./src/js/calendario/citas.js').then(m => m.crearModalNuevaCita(fechaIso));
            },
            
            cargarCitasDia: function(fechaIso) {
                import('./src/js/calendario/calendario.js').then(m => {
                    m.cargarCitasDia(new Date(fechaIso));
                });
            },
            
            mostrarInfoCita: function(citaId) {
                // Buscar cita y mostrar modal de información
                console.log('Mostrando información de cita:', citaId);
            },
            
            mostrarDetallesSolicitud: function(solicitudId) {
                import('./src/js/solicitudes/gestor-solicitudes.js').then(m => {
                    m.mostrarDetalleSolicitud(solicitudId);
                });
            },
            
            responderSolicitud: function(solicitudId) {
                import('./src/js/solicitudes/respuestas.js').then(m => {
                    m.mostrarModalResponder(solicitudId);
                });
            },
            
            agendarDesdeSolicitud: function(solicitudId) {
                import('./src/js/calendario/citas.js').then(m => {
                    m.mostrarModalAgendaDesdeSolicitud(solicitudId);
                });
            },
            
            mostrarDetallePaciente: function(pacienteId) {
                import('./src/js/pacientes/gestor-pacientes.js').then(m => {
                    m.mostrarDetallePaciente(pacienteId);
                });
            },
            
            registrarAtencion: function(pacienteRut, pacienteNombre) {
                import('./src/js/seguimiento/atenciones.js').then(m => {
                    m.mostrarModalAtencion(pacienteRut, pacienteNombre);
                });
            }
        };
        
        // CSS personalizado para mejorar la apariencia
        document.addEventListener('DOMContentLoaded', function() {
            // Agregar estilos CSS adicionales si son necesarios
            const styles = `
                <style>
                    .form-step { display: none; }
                    .form-step.active { display: block; }
                    
                    .time-slot {
                        transition: all 0.2s ease;
                        margin: 4px;
                        min-height: 50px;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                    }
                    
                    .time-slot:hover:not(.disabled) {
                        background: var(--light-blue) !important;
                        border-color: var(--health-green) !important;
                    }
                    
                    .time-slot.selected {
                        background: var(--primary-blue) !important;
                        color: white !important;
                        border-color: var(--primary-blue) !important;
                    }
                    
                    .time-slots-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                        gap: 8px;
                        margin-top: 16px;
                    }
                    
                    .calendar-appointment:hover {
                        background: var(--health-green) !important;
                    }
                    
                    .appointment-item {
                        display: flex;
                        align-items: center;
                        gap: 16px;
                        padding: 12px;
                        border: 1px solid var(--gray-300);
                        border-radius: 8px;
                        margin-bottom: 8px;
                        transition: all 0.2s ease;
                    }
                    
                    .appointment-item:hover {
                        background: var(--light-blue);
                        border-color: var(--primary-blue);
                    }
                    
                    .appointment-time {
                        font-weight: bold;
                        color: var(--primary-blue);
                        min-width: 60px;
                    }
                    
                    .appointment-details {
                        flex: 1;
                    }
                    
                    .appointment-patient {
                        font-weight: 600;
                        color: var(--text-dark);
                        margin-bottom: 4px;
                    }
                    
                    .appointment-professional {
                        font-size: 14px;
                        color: var(--gray-600);
                    }
                    
                    .appointment-type {
                        font-size: 12px;
                        color: var(--gray-500);
                    }
                    
                    .status-badge {
                        display: inline-flex;
                        align-items: center;
                        gap: 4px;
                        padding: 4px 8px;
                        border-radius: 4px;
                        font-size: 12px;
                        font-weight: bold;
                    }
                    
                    .status-badge.programada {
                        background: rgba(59, 130, 246, 0.1);
                        color: #3b82f6;
                    }
                    
                    .status-badge.confirmada {
                        background: rgba(16, 185, 129, 0.1);
                        color: #10b981;
                    }
                    
                    .status-badge.completada {
                        background: rgba(5, 150, 105, 0.1);
                        color: #059669;
                    }
                    
                    .status-badge.cancelada {
                        background: rgba(239, 68, 68, 0.1);
                        color: #ef4444;
                    }
                    
                    .range-group {
                        display: flex;
                        align-items: center;
                        gap: 12px;
                    }
                    
                    .range-value {
                        min-width: 40px;
                        height: 40px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        font-weight: bold;
                        font-size: 16px;
                    }
                    
                    .radio-group {
                        display: flex;
                        flex-direction: column;
                        gap: 12px;
                    }
                    
                    .radio-option {
                        display: flex;
                        align-items: flex-start;
                        gap: 12px;
                        padding: 16px;
                        border: 2px solid var(--gray-300);
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.2s ease;
                    }
                    
                    .radio-option:hover {
                        border-color: var(--primary-blue);
                        background: var(--light-blue);
                    }
                    
                    .radio-option input[type="radio"]:checked + .radio-content {
                        color: var(--primary-blue);
                    }
                    
                    .radio-option:has(input[type="radio"]:checked) {
                        border-color: var(--primary-blue);
                        background: var(--light-blue);
                    }
                    
                    .checkbox-group {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 8px;
                    }
                    
                    .checkbox-option {
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        padding: 8px;
                        border-radius: 6px;
                        cursor: pointer;
                        transition: background 0.2s ease;
                    }
                    
                    .checkbox-option:hover {
                        background: var(--light-blue);
                    }
                    
                    .radio-group-inline {
                        display: flex;
                        gap: 16px;
                        flex-wrap: wrap;
                    }
                    
                    .radio-inline {
                        display: flex;
                        align-items: center;
                        gap: 6px;
                        cursor: pointer;
                    }
                    
                    @media (max-width: 768px) {
                        .form-row {
                            flex-direction: column;
                        }
                        
                        .time-slots-grid {
                            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                        }
                        
                        .radio-group-inline {
                            flex-direction: column;
                            gap: 8px;
                        }
                        
                        .checkbox-group {
                            grid-template-columns: 1fr;
                        }
                    }
                </style>
            `;
            
            document.head.insertAdjacentHTML('beforeend', styles);
        });
    </script>
</body>
</html>
